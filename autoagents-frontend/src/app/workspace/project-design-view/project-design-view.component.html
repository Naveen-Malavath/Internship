<div class="project-design-view">
  <header class="project-design-view__header">
    <h2 class="project-design-view__title">Project Designs</h2>
    
    <button
      type="button"
      class="project-design-view__generate-btn"
      (click)="onGenerateDesigns()"
      [disabled]="isLoadingDesigns"
    >
      Generate Designs
    </button>
  </header>

  <!-- Loading State Removed - diagrams render instantly -->

  <!-- Error State -->
  <div *ngIf="error && !isLoadingDesigns" class="project-design-view__message project-design-view__message--error">
    <p>{{ error }}</p>
  </div>

  <!-- No Designs State -->
  <div *ngIf="hasNoDesigns && !isLoadingDesigns && !error" class="project-design-view__message project-design-view__message--info">
    <p>No designs yet. Click "Generate Designs" to create HLD, LLD, and DBD diagrams.</p>
  </div>

  <!-- Design Type Selection -->
  <div *ngIf="designs && !isLoadingDesigns" class="project-design-view__tabs">
    <button
      type="button"
      class="project-design-view__tab"
      [class.project-design-view__tab--active]="currentDesignType === 'LLD'"
      (click)="onDesignTypeChange('LLD')"
    >
      LLD
    </button>
    <button
      type="button"
      class="project-design-view__tab"
      [class.project-design-view__tab--active]="currentDesignType === 'HLD'"
      (click)="onDesignTypeChange('HLD')"
    >
      HLD
    </button>
    <button
      type="button"
      class="project-design-view__tab"
      [class.project-design-view__tab--active]="currentDesignType === 'DBD'"
      (click)="onDesignTypeChange('DBD')"
    >
      DBD
    </button>

    <!-- DBD View Mode Toggle (Graph/Table) - only visible when DBD is selected -->
    <div *ngIf="currentDesignType === 'DBD'" class="project-design-view__view-toggle">
      <span class="project-design-view__view-toggle-label">View:</span>
      <button
        type="button"
        class="project-design-view__view-toggle-btn"
        [class.project-design-view__view-toggle-btn--active]="dbdViewMode === 'graph'"
        (click)="onDbdViewModeChange('graph')"
      >
        Graph
      </button>
      <button
        type="button"
        class="project-design-view__view-toggle-btn"
        [class.project-design-view__view-toggle-btn--active]="dbdViewMode === 'table'"
        (click)="onDbdViewModeChange('table')"
      >
        Table
      </button>
    </div>
  </div>

  <!-- Mermaid Editor (Graph View) -->
  <!-- Show editor if we have designs OR if we have a currentMermaid (to preserve last diagram during loading/errors) -->
  <!-- Editor remains visible during loading to show last diagram -->
  <!-- Hide when DBD table view is active -->
  <div
    *ngIf="(designs || currentMermaid !== null) && !(currentDesignType === 'DBD' && dbdViewMode === 'table')"
    class="project-design-view__editor"
  >
    <workspace-view
      [projectId]="projectId"
      [mermaidSource]="currentMermaid"
      [mermaidEditorContent]="currentMermaid ?? ''"
      [mermaidStyleConfig]="currentStyleConfig"
      [designGenerationKey]="designGenerationCounter"
      (mermaidChange)="onMermaidChange($event)"
    ></workspace-view>
  </div>

  <!-- DBD Table View -->
  <div
    *ngIf="currentDesignType === 'DBD' && dbdViewMode === 'table' && (designs || currentMermaid !== null)"
    class="project-design-view__table-view"
  >
    <app-dbd-table-view [entities]="dbEntities"></app-dbd-table-view>
  </div>
</div>

