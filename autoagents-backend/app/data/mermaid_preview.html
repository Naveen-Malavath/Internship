<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoAgents - HLD, LLD, DBD Diagram Preview</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1976D2;
            border-bottom: 3px solid #1976D2;
            padding-bottom: 10px;
        }
        h2 {
            color: #424242;
            margin-top: 40px;
            padding: 10px;
            background: #E3F2FD;
            border-left: 4px solid #1976D2;
        }
        .diagram-section {
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        .description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            padding: 10px;
            background: #fff;
            border-left: 3px solid #FFC107;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #E0E0E0;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
            font-weight: bold;
            transition: background 0.3s;
        }
        .tab-button.active {
            background: #1976D2;
            color: white;
        }
        .tab-button:hover {
            background: #BDBDBD;
        }
        .tab-button.active:hover {
            background: #1565C0;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AutoAgents Architecture Diagrams</h1>
        <p style="color: #666; font-size: 16px; margin-bottom: 30px;">
            Complete visualization of High-Level Design (HLD), Low-Level Design (LLD), 
            and Database Design (DBD) for the AutoAgents project.
        </p>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('hld', event)">High-Level Design (HLD)</button>
            <button class="tab-button" onclick="showTab('lld', event)">Low-Level Design (LLD)</button>
            <button class="tab-button" onclick="showTab('dbd', event)">Database Design (DBD)</button>
        </div>

        <!-- HLD Tab -->
        <div id="hld" class="tab-content active">
            <div class="diagram-section">
                <h2>üìä High-Level Design (HLD)</h2>
                <div class="description">
                    <strong>Purpose:</strong> Shows the system architecture with major components including 
                    User layer, Frontend (Angular), Backend (FastAPI), AI Agents, Claude API, and MongoDB database.
                </div>
                <div class="mermaid">
graph TD
    %% User Layer
    User["User/Client"]:::userClass
    
    %% Frontend Layer
    Angular["Angular Web App<br/>- Project Wizard<br/>- Chat Interface<br/>- Workspace View"]:::frontendClass
    
    %% Backend API Layer
    FastAPI["FastAPI Backend<br/>- REST Endpoints<br/>- Auth Middleware<br/>- CORS Support"]:::backendClass
    
    %% Agent Services Layer
    Agent1["Agent-1 Service<br/>Feature Generation"]:::agentClass
    Agent2["Agent-2 Service<br/>Story Generation"]:::agentClass
    Agent3["Agent-3 Service<br/>Diagram Generation"]:::agentClass
    
    %% AI Provider
    Claude["Claude AI API<br/>Anthropic Sonnet 4.5"]:::externalClass
    
    %% Database Layer
    MongoDB["MongoDB Database<br/>- Projects<br/>- Features<br/>- Stories<br/>- Diagrams"]:::dbClass
    
    %% User Flow
    User -->|"Accesses"| Angular
    Angular -->|"API Requests"| FastAPI
    
    %% Backend to Agents
    FastAPI -->|"Generate Features"| Agent1
    FastAPI -->|"Generate Stories"| Agent2
    FastAPI -->|"Generate Diagrams"| Agent3
    
    %% Agents to AI
    Agent1 -->|"LLM Prompt"| Claude
    Agent2 -->|"LLM Prompt"| Claude
    Agent3 -->|"LLM Prompt"| Claude
    
    %% Claude Response
    Claude -->|"JSON Response"| Agent1
    Claude -->|"JSON Response"| Agent2
    Claude -->|"Mermaid Code"| Agent3
    
    %% Agents to Database
    Agent1 -->|"Save Features"| MongoDB
    Agent2 -->|"Save Stories"| MongoDB
    Agent3 -->|"Save Diagrams"| MongoDB
    
    %% Database to Backend
    MongoDB -->|"Query Results"| FastAPI
    
    %% Backend to Frontend
    FastAPI -->|"JSON Response"| Angular
    
    %% Frontend to User
    Angular -->|"Display Results"| User
    
    %% Style Definitions
    classDef userClass fill:#E1F5FE,stroke:#01579B,stroke-width:3px,color:#000
    classDef frontendClass fill:#E8EAF6,stroke:#3F51B5,stroke-width:2px,color:#000
    classDef backendClass fill:#FFF9C4,stroke:#F57F17,stroke-width:2px,color:#000
    classDef agentClass fill:#FFE0B2,stroke:#E65100,stroke-width:2px,color:#000
    classDef externalClass fill:#F8BBD0,stroke:#C2185B,stroke-width:2px,color:#000
    classDef dbClass fill:#C8E6C9,stroke:#2E7D32,stroke-width:2px,color:#000
                </div>
            </div>
        </div>

        <!-- LLD Tab -->
        <div id="lld" class="tab-content">
            <div class="diagram-section">
                <h2>‚öôÔ∏è Low-Level Design (LLD)</h2>
                <div class="description">
                    <strong>Purpose:</strong> Details component interactions, class structures, API routers, 
                    agent services, and data flow between frontend and backend components.
                </div>
                <div class="mermaid">
classDiagram
    %% Frontend Components
    class AppComponent {
        +chatMessages: Signal
        +workspaceItems: Signal
        +currentAgent: Signal
        +handleUserInput()
        +updateWorkspace()
    }
    
    class ProjectWizard {
        +currentStep: number
        +projectData: ProjectCreate
        +nextStep()
        +submitProject()
    }
    
    class WorkspaceView {
        +features: Feature[]
        +stories: Story[]
        +diagrams: Diagram[]
        +editItem()
        +removeItem()
    }
    
    %% Backend Routers
    class AuthRouter {
        +POST /auth/login
        +POST /auth/register
        -verifyPassword()
        -generateJWT()
    }
    
    class ProjectsRouter {
        +POST /projects
        +GET /projects/user/userId
        +GET /projects/projectId
        -validateOwnership()
    }
    
    class FeaturesRouter {
        +POST /projects/projectId/features/generate
        +GET /projects/projectId/features
        -callAgent1()
    }
    
    class StoriesRouter {
        +POST /projects/projectId/stories/generate
        +GET /projects/projectId/stories
        -callAgent2()
    }
    
    class DiagramsRouter {
        +POST /projects/projectId/diagram/generate
        +GET /projects/projectId/diagram
        -callAgent3()
    }
    
    %% Agent Services
    class Agent1Service {
        -model: string
        +generateFeatures()
        -buildPrompt()
        -parseResponse()
    }
    
    class Agent2Service {
        -model: string
        +generateStories()
        -buildPrompt()
        -parseResponse()
    }
    
    class Agent3Service {
        -model: string
        +generateMermaid()
        -buildPrompt()
        -cleanMermaidCode()
        -removeTruncatedStyles()
    }
    
    class ClaudeClient {
        +getClient()
        +extractText()
        -handleAPIError()
    }
    
    %% Database Layer
    class Database {
        +users: Collection
        +projects: Collection
        +features: Collection
        +stories: Collection
        +diagrams: Collection
        +connectToMongo()
        +closeConnection()
    }
    
    %% Relationships - Frontend
    AppComponent --> ProjectWizard
    AppComponent --> WorkspaceView
    
    %% Relationships - Backend Routers
    ProjectsRouter --> Database
    FeaturesRouter --> Agent1Service
    FeaturesRouter --> Database
    StoriesRouter --> Agent2Service
    StoriesRouter --> Database
    DiagramsRouter --> Agent3Service
    DiagramsRouter --> Database
    
    %% Relationships - Services
    Agent1Service --> ClaudeClient
    Agent2Service --> ClaudeClient
    Agent3Service --> ClaudeClient
    
    Agent1Service --> Database
    Agent2Service --> Database
    Agent3Service --> Database
    
    %% Style Definitions
    class AppComponent:::frontendClass
    class ProjectWizard:::frontendClass
    class WorkspaceView:::frontendClass
    class AuthRouter:::backendClass
    class ProjectsRouter:::backendClass
    class FeaturesRouter:::backendClass
    class StoriesRouter:::backendClass
    class DiagramsRouter:::backendClass
    class Agent1Service:::serviceClass
    class Agent2Service:::serviceClass
    class Agent3Service:::serviceClass
    class ClaudeClient:::externalClass
    class Database:::dbClass
    
    classDef frontendClass fill:#E8EAF6,stroke:#3F51B5,color:#000
    classDef backendClass fill:#FFF9C4,stroke:#F57F17,color:#000
    classDef serviceClass fill:#FFE0B2,stroke:#E65100,color:#000
    classDef externalClass fill:#F8BBD0,stroke:#C2185B,color:#000
    classDef dbClass fill:#C8E6C9,stroke:#2E7D32,color:#000
                </div>
            </div>
        </div>

        <!-- DBD Tab -->
        <div id="dbd" class="tab-content">
            <div class="diagram-section">
                <h2>üóÑÔ∏è Database Design (DBD)</h2>
                <div class="description">
                    <strong>Purpose:</strong> Entity-Relationship Diagram showing MongoDB collections, 
                    their fields, data types, relationships, and keys (PK, FK, UK).
                </div>
                <div class="mermaid">
erDiagram
    USERS ||--o{ PROJECTS : owns
    PROJECTS ||--o{ FEATURES : includes
    FEATURES ||--o{ STORIES : contains
    PROJECTS ||--o{ DIAGRAMS : has
    PROJECTS ||--o{ FEEDBACK : receives
    
    USERS {
        uuid id PK
        varchar email UK
        varchar password_hash
        varchar name
        timestamp created_at
        timestamp updated_at
    }
    
    PROJECTS {
        uuid id PK
        uuid owner_id FK
        varchar title
        text prompt
        varchar status
        varchar methodology
        varchar industry
        timestamp created_at
        timestamp updated_at
    }
    
    FEATURES {
        uuid id PK
        uuid project_id FK
        varchar title
        text description
        json acceptance_criteria
        varchar source
        varchar status
        int order_index
        varchar run_id
        timestamp created_at
        timestamp updated_at
    }
    
    STORIES {
        uuid id PK
        uuid feature_id FK
        uuid project_id FK
        text user_story
        json acceptance_criteria
        json implementation_notes
        varchar status
        varchar run_id
        timestamp created_at
        timestamp updated_at
    }
    
    DIAGRAMS {
        uuid id PK
        uuid project_id FK
        varchar diagram_type
        text mermaid_source
        json style_config
        text svg_cache
        varchar run_id
        timestamp created_at
        timestamp updated_at
    }
    
    FEEDBACK {
        uuid id PK
        uuid project_id FK
        varchar agent_type
        int rating
        text comment
        json context
        timestamp created_at
    }
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName, event) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Deactivate all tab buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Activate selected tab button
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Force Mermaid to re-render diagrams in the newly shown tab
            if (typeof mermaid !== 'undefined') {
                setTimeout(() => {
                    mermaid.run({
                        querySelector: `#${tabName} .mermaid`
                    });
                }, 100);
            }
        }
    </script>
</body>
</html>

