classDiagram
    %% Frontend Layer
    class StorefrontApp {
    +React
    +authenticate()
    +displayProducts()
    +manageCart()
    +processCheckout()
    }

    class AdminDashboard {
    +ModularUI
    +configureModules()
    +viewAnalytics()
    +manageWorkflows()
    +generateReports()
    }

    class MobileApp {
    +Native
    +syncOfflineData()
    +pushNotifications()
    +biometricAuth()
    }

    %% API Gateway Layer
    class APIGateway {
    +String
    +Map
    ~String
    +AuthenticationFilter
    +RateLimiter
    +routeRequest(request)
    +authenticateUser(token)
    +applyRateLimit(userId)
    +logRequest(request)
    }

    class GraphQLEndpoint {
    +Schema
    +Resolver
    +executeQuery(query)
    +validateSchema()
    +handleSubscriptions()
    }

    class RESTEndpoint {
    +Map
    ~String
    +handleGET(path, params)
    +handlePOST(path, body)
    +handlePUT(path, body)
    +handleDELETE(path, params)
    }

    %% Core Microservices
    class CatalogService {
    +ProductRepository
    +CategoryRepository
    +SearchEngine
    +createProduct(product)
    +updateProduct(id, product)
    +searchProducts(criteria)
    +getProductHierarchy()
    +manageVariants(productId)
    }

    class InventoryService {
    +InventoryRepository
    +AllocationEngine
    +ReservationManager
    +updateStock(sku, quantity)
    +reserveInventory(items)
    +releaseReservation(reservationId)
    +syncAcrossChannels()
    +getAvailability(sku)
    }

    class OrderService {
    +OrderRepository
    +PaymentProcessor
    +FulfillmentOrchestrator
    +createOrder(orderData)
    +updateOrderStatus(orderId, status)
    +processPayment(paymentInfo)
    +trackShipment(orderId)
    +handleReturns(returnRequest)
    }

    class PricingService {
    +PriceRepository
    +PromotionEngine
    +TierCalculator
    +calculatePrice(productId, customerId)
    +applyPromotions(cartItems)
    +getTierPricing(customerId)
    +validatePriceRules()
    }

    class CustomerService {
    +CustomerRepository
    +ProfileManager
    +PreferenceEngine
    +createCustomer(customerData)
    +updateProfile(customerId, profile)
    +getPreferences(customerId)
    +manageAddresses(customerId)
    +handleAuthentication()
    }

    class LoyaltyService {
    +LoyaltyRepository
    +PointsCalculator
    +RewardsEngine
    +TierManager
    +calculatePoints(transaction)
    +redeemRewards(customerId, rewardId)
    +updateTierStatus(customerId)
    +trackEngagement(activity)
    }

    %% AI & Analytics Layer
    class PersonalizationEngine {
    +MLModelManager
    +BehaviorTracker
    +RecommendationService
    +generateRecommendations(customerId)
    +updateBehaviorModel(interaction)
    +personalizeContent(customerId)
    +optimizePricing(customerId)
    }

    class AnalyticsService {
    +MetricsCollector
    +ReportGenerator
    +AlertManager
    +collectMetrics(event)
    +generateReport(criteria)
    +sendAlert(condition)
    +trackPerformance()
    }

    %% Integration Layer
    class IntegrationHub {
    +ConnectorRegistry
    +MessageQueue
    +TransformationEngine
    +registerConnector(connector)
    +processMessage(message)
    +transformData(data, format)
    +routeToDestination(message)
    }

    class PaymentConnector {
    +PaymentGateway
    +processPayment(paymentData)
    +refundPayment(transactionId)
    +validateCard(cardInfo)
    }

    class ShippingConnector {
    +ShippingProvider
    +calculateRates(shipment)
    +createLabel(shipment)
    +trackPackage(trackingId)
    }

    class ERPConnector {
    +ERPSystem
    +syncInventory()
    +updateOrders()
    +syncCustomers()
    }

    %% Data Layer
    class ProductDatabase {
    +products
    +categories
    +variants
    +attributes
    +executeQuery(sql)
    +createIndex(field)
    +optimizePerformance()
    }

    class CustomerDatabase {
    +customers
    +profiles
    +preferences
    +addresses
    +loyalty_accounts
    +executeQuery(sql)
    +encryptPII(data)
    }

    class OrderDatabase {
    +orders
    +order_items
    +payments
    +shipments
    +executeQuery(sql)
    +maintainConsistency()
    }

    class InventoryDatabase {
    +inventory
    +reservations
    +allocations
    +warehouses
    +executeQuery(sql)
    +handleConcurrency()
    }

    class AnalyticsDatabase {
    +events
    +metrics
    +reports
    +user_behavior
    +executeQuery(sql)
    +aggregateData()
    }

    %% Cache Layer
    class RedisCache {
    +String
    +int
    +set(key, value, ttl)
    +get(key)
    +delete(key)
    +flushCache()
    }

    class ElasticsearchIndex {
    +String
    +indexDocument(doc)
    +search(query)
    +updateMapping()
    +optimizeIndex()
    }

    %% Message Queue
    class MessageBroker {
    +Queue
    +publishMessage(topic, message)
    +subscribeToTopic(topic, handler)
    +processDeadLetters()
    +monitorQueues()
    }

    %% Multi-tenant Support
    class TenantManager {
    +TenantRepository
    +ConfigurationManager
    +DataIsolationLayer
    +createTenant(tenantData)
    +configureTenant(tenantId, config)
    +isolateData(tenantId)
    +manageBranding(tenantId)
    }

    %% Relationships
    StorefrontApp --> APIGateway
    AdminDashboard --> APIGateway
    MobileApp --> APIGateway

    APIGateway --> GraphQLEndpoint
    APIGateway --> RESTEndpoint
    APIGateway --> TenantManager

    GraphQLEndpoint --> CatalogService
    GraphQLEndpoint --> InventoryService
    GraphQLEndpoint --> OrderService
    GraphQLEndpoint --> CustomerService
    GraphQLEndpoint --> LoyaltyService

    RESTEndpoint --> CatalogService
    RESTEndpoint --> InventoryService
    RESTEndpoint --> OrderService
    RESTEndpoint --> PricingService
    RESTEndpoint --> CustomerService
    RESTEndpoint --> LoyaltyService

    CatalogService --> ProductDatabase
    CatalogService --> ElasticsearchIndex
    CatalogService --> RedisCache
    CatalogService --> MessageBroker

    InventoryService --> InventoryDatabase
    InventoryService --> RedisCache
    InventoryService --> MessageBroker

    OrderService --> OrderDatabase
    OrderService --> IntegrationHub
    OrderService --> MessageBroker

    CustomerService --> CustomerDatabase
    CustomerService --> RedisCache
    CustomerService --> PersonalizationEngine

    LoyaltyService --> CustomerDatabase
    LoyaltyService --> MessageBroker
    LoyaltyService --> AnalyticsService

    PricingService --> ProductDatabase
    PricingService --> PersonalizationEngine
    PricingService --> RedisCache

    PersonalizationEngine --> AnalyticsDatabase
    PersonalizationEngine --> CustomerDatabase
    PersonalizationEngine --> MessageBroker

    AnalyticsService --> AnalyticsDatabase
    AnalyticsService --> MessageBroker

    IntegrationHub --> PaymentConnector
    IntegrationHub --> ShippingConnector
    IntegrationHub --> ERPConnector
    IntegrationHub --> MessageBroker

    TenantManager --> ProductDatabase
    TenantManager --> CustomerDatabase
    TenantManager --> OrderDatabase
    TenantManager --> InventoryDatabase

    %% Styling
    classDef frontend fill:#E3F2FD,stroke:#1976D2,color:#000
    classDef gateway fill:#F3E5F5,stroke:#7B1FA2,color:#000
    classDef service fill:#FFF3E0,stroke:#F57C00,color:#000
    classDef ai fill:#E8F5E9,stroke:#388E3C,color:#000
    classDef integration fill:#FCE4EC,stroke:#C2185B,color:#000
    classDef database fill:#E0F2F1,stroke:#00695C,color:#000
    classDef cache fill:#FFF8E1,stroke:#FF8F00,color:#000
    classDef infrastructure fill:#EFEBE9,stroke:#5D4037,color:#000

    StorefrontApp:::frontend
    AdminDashboard:::frontend
    MobileApp:::frontend

    APIGateway:::gateway
    GraphQLEndpoint:::gateway
    RESTEndpoint:::gateway

    CatalogService:::service
    InventoryService:::service
    OrderService:::service
    PricingService:::service
    CustomerService:::service
    LoyaltyService:::service

    PersonalizationEngine:::ai
    AnalyticsService:::ai

    IntegrationHub:::integration
    PaymentConnector:::integration
    ShippingConnector:::integration
    ERPConnector:::integration

    ProductDatabase:::database
    CustomerDatabase:::database
    OrderDatabase:::database
    InventoryDatabase:::database
    AnalyticsDatabase:::database

    RedisCache:::cache
    ElasticsearchIndex:::cache

    MessageBroker:::infrastructure
    TenantManager:::infrastructure